# Stage 1: Build dependencies (not needed in development)
FROM golang:1.21 AS builder

WORKDIR /usr/src/app

COPY go.mod go.sum ./
RUN go mod download

COPY . ./

# Stage 2: Development stage
FROM golang:1.21

WORKDIR /usr/src/app

# Install Air globally
RUN go install github.com/cosmtrek/air@latest

# Copy only the source code for development
COPY . ./

# Expose the development port
EXPOSE 4000

# Run Air for hot reloading
CMD ["air"]